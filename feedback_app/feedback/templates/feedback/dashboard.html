{% extends 'feedback/base.html' %}

{% block content %}
    <h2>Responses</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Surname</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for response in responses %}
                <tr>
                    <td>{{ response.name }}</td>
                    <td>{{ response.surname }}</td>
                    <td>{{ response.date }}</td>
                    <td>
                        <a href="{% url 'view_response' response.id %}" class="btn btn-sm">
                            <i class="bi bi-eye"></i>
                        </a>
                        <form action="{% url 'delete_response' response.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm" onclick="return confirm('Are you sure you want to delete this response?');">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#qrModal" onclick="fetchQRCode()">Generate QR Code</button>
    <a href="{% url 'question_list' %}" class="btn btn-dark">Questions</a>

    <!-- QR Code Modal -->
    <div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="qrModalLabel">Generated QR Code</h5>
                    <button type="button" class="btn-dark" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center" id="qrCodeContainer">
                    <p>QR Code will be displayed here</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function fetchQRCode() {
            fetch("{% url 'generate_qr_code' %}")
            .then(response => response.json())
            .then(data => {
                if (data.qr_code) {
                    document.getElementById('qrCodeContainer').innerHTML = '<img src="data:image/png;base64,' + data.qr_code + '" alt="QR Code" class="img-fluid">';
                } else {
                    document.getElementById('qrCodeContainer').innerHTML = '<p>QR Code generation failed</p>';
                }
            })
            .catch(error => {
                document.getElementById('qrCodeContainer').innerHTML = '<p>Error fetching QR Code</p>';
            });
        }
    </script>
{% endblock %}
